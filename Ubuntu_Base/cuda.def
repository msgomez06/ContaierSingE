Bootstrap: localimage
From: ubuntu.sif

%files
	#files used to set up CUDA
	cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600
    cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb /opt/cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb

%post
	apt_srcs_path=/etc/apt/sources.list
	echo "deb http://ch.archive.ubuntu.com/ubuntu/ jammy universe" >> $apt_srcs_path
	echo "deb http://ch.archive.ubuntu.com/ubuntu/ jammy multiverse" >> $apt_srcs_path
	
	apt-get update
	apt-get -y install nautilus wget libpci3 qtbase5-dev vim gcc
    
    apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/3bf863cc.pub
    
    #wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin
    #mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600
    #wget https://developer.download.nvidia.com/compute/cuda/12.0.0/local_installers/cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb
    dpkg -i /opt/cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb
    #cp /var/cuda-repo-ubuntu2204-12-0-local/cuda-*-keyring.gpg /usr/share/keyrings/sudo 
    cp /var/cuda-repo-ubuntu2204-12-0-local/cuda-852BBB4F-keyring.gpg /usr/share/keyrings/

    apt-get update 
    
    export DEBIAN_FRONTEND=noninteractive

    apt-get -y install cuda

	apt-get clean -y
	apt-get autoremove -y
	
	rm /opt/cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb

%environment
    #export DEBIAN_FRONTEND=noninteractive

%help
